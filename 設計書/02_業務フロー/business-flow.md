```uml
@startuml
    title: 購入
    ユーザー -> Webサーバー : 検索(商品名)
    Webサーバー -> DBサーバー : 検索処理(商品名)
    DBサーバー -> DBサーバー : 検索処理
    DBサーバー -> Webサーバー : 検索結果
    Webサーバー -> ユーザー : 検索結果
    opt 商品クリック(詳細表示)
      ユーザー -> Webサーバー : 商品クリック
      Webサーバー -> DBサーバー : 商品照会
      DBサーバー -> DBサーバー : 　照会処理
      DBサーバー -> Webサーバー : 照会結果
      Webサーバー -> ユーザー : 詳細情報表示
      alt 在庫あり
        opt カートに商品を追加
          ユーザー -> Webサーバー : カートに追加し、カート内を表示
          Webサーバー -> DBサーバー : 商品照会
          DBサーバー -> DBサーバー : カートに追加された分の商品数を減らし\nカート内の単価を照会
          DBサーバー -> Webサーバー :カート内の商品の単価情報を渡す
          Webサーバー -> ユーザー:カート内を表示し、合計金額を表示
          opt 配送
            ユーザー -> Webサーバー : 確定ボタンをクリック
            Webサーバー -> DBサーバー :購入情報の書き込み（カートの情報）
            DBサーバー -> DBサーバー : 配送情報検索＆購入情報登録
            DBサーバー -> Webサーバー :配送情報を渡す
            Webサーバー -> ユーザー:商品が配送される
        end
      end
else 在庫なし
Webサーバー -> DBサーバー : 商品照会
DBサーバー -> Webサーバー : 照会結果
Webサーバー -> ユーザー : 在庫結果
end
opt 購入履歴
ユーザー ->Webサーバー :購入履歴をクリック
Webサーバー -> DBサーバー :購入履歴照会
DBサーバー -> DBサーバー : 購入履歴取得処理
DBサーバー -> Webサーバー :照会結果
Webサーバー -> ユーザー :購入履歴の結果
end





@enduml
````
